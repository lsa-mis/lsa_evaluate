<div class="container">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1><%= @container.name %></h1>
    <%= link_to "Return to Manage Collections", containers_path, class: "btn btn-outline-secondary" %>
  </div>

  <p class="lead mb-4">
    Select dates for a new contest period and choose descriptions to carry forward. Then click the button to create new contest instances.
  </p>

  <%= simple_form_for :dates, 
    url: create_instances_for_selected_descriptions_container_contest_descriptions_url, 
    method: :post, 
    html: { class: 'needs-validation', novalidate: true },
    data: { 
      controller: "checkboxselect form-validation",
      checkboxselect_error_text_value: "Please select at least one contest description.",
      form_validation_target: "form",
      action: "submit->checkboxselect#submitForm submit->form-validation#submitForm",
      turbo_frame: "_top" 
    } do |form| %>

    <%= form.hidden_field :container, value: @container.id %>

    <div class="row mb-4">
      <div class="col-md-6">
        <%= form.label :date_open, "Date Open", class: "form-label" %>
        <%= form.datetime_field :date_open, 
          class: "form-control", 
          required: true,
          data: { 
            form_validation_target: "dateOpen",
            action: "change->form-validation#validateDates"
          }
        %>
      </div>
      <div class="col-md-6">
        <%= form.label :date_closed, "Date Closed", class: "form-label" %>
        <%= form.datetime_field :date_closed, 
          class: "form-control", 
          required: true,
          data: { 
            form_validation_target: "dateClosed",
            action: "change->form-validation#validateDates"
          }
        %>
      </div>
    </div>

    <div class="alert alert-danger d-none" data-checkboxselect-target="errorMessage" role="alert"></div>

    <h2 class="mb-3">Contest Descriptions</h2>
    <div class="table-responsive">
      <table class="table table-striped table-hover">
        <thead class="table-light">
          <tr>
            <th>
              <div class="form-check">
                <input type="checkbox" class="form-check-input" id="select_all" data-checkboxselect-target="checkboxAll" data-action="change->checkboxselect#toggleCheckbox">
                <label class="form-check-label" for="select_all">Select All</label>
              </div>
            </th>
            <th>Name</th>
            <th>Short Name</th>
            <th>Eligibility Rules</th>
          </tr>
        </thead>
        <tbody>
          <% @contest_descriptions.each do |description| %>
            <tr>
              <td>
                <div class="form-check">
                  <%= form.check_box "checkbox[#{description.id}]", 
                    id: "descr_ids_#{description.id}", 
                    class: "form-check-input", 
                    data: {
                      checkboxselect_target: "checkbox",
                      action: "change->checkboxselect#toggleCheckboxAll"
                    }
                  %>
                  <label class="form-check-label" for="descr_ids_<%= description.id %>">Select</label>
                </div>
              </td>
              <td><%= description.name %></td>
              <td><%= description.short_name %></td>
              <% eligibility_plain = description.eligibility_rules.to_plain_text %>
              <td><%= truncate(eligibility_plain, length: 100) %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>

    <div class="mt-4">
      <%= form.submit 'Create Instances for Selected Contest Descriptions', class: "btn btn-primary" %>
    </div>
  <% end %>
</div>